<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>文字抽獎</title>
<style>
  body{
    margin:0;
    font-family:system-ui;
    background:#f3f6ff;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
  }
  .box{
    background:white;
    padding:30px;
    border-radius:20px;
    box-shadow:0 10px 30px rgba(0,0,0,.1);
    text-align:center;
    width:min(90vw,460px);
  }
  .display{
    font-size:32px;
    font-weight:900;
    height:90px;
    display:flex;
    align-items:center;
    justify-content:center;
    border:3px dashed #2563eb;
    border-radius:14px;
    margin-bottom:20px;
  }
  .log{
    margin-top:12px;
    font-size:14px;
    max-height:220px;
    overflow:auto;
    text-align:left;
  }
  button{
    font-size:22px;
    padding:14px 30px;
    border:none;
    border-radius:14px;
    background:#2563eb;
    color:white;
    font-weight:700;
    cursor:pointer;
  }
  button:disabled{opacity:.5}
</style>
</head>
<body>

<div class="box">
  <div id="display" class="display">準備中</div>
  <button id="btn">抽獎</button>
  <div id="log" class="log"></div>
</div>

<script>
/* ===== 獎項＋百分率 ===== */
const PRIZES = [
  { text: '150$', rate: 1 },
  { text: '可爾必思', rate: 23 },
  { text: '棉花糖', rate: 12 },
  { text: '女僕 or 霸總服務', rate: 13 },
  { text: '再來一次', rate: 13 },
  { text: '10連抽', rate: 2 },
  { text: '沒抽到', rate: 36 }
];
/* ====================== */

const display = document.getElementById('display');
const btn = document.getElementById('btn');
const log = document.getElementById('log');

function pickPrize(exclude = []){
  const pool = PRIZES.filter(p => !exclude.includes(p.text));
  let r = Math.random() * 100;
  let sum = 0;
  for(const p of pool){
    sum += p.rate;
    if(r <= sum) return p;
  }
  return pool[pool.length - 1];
}

function animateOnce(exclude = []){
  return new Promise(resolve=>{
    let i = 0;
    const t = setInterval(()=>{
      display.textContent = PRIZES[i % PRIZES.length].text;
      i++;
    }, 30);

    setTimeout(()=>{
      clearInterval(t);
      const prize = pickPrize(exclude);
      display.textContent = prize.text;
      resolve(prize);
    }, 300); // 0.3 秒動畫
  });
}

async function doDraw(){
  btn.disabled = true;
  log.innerHTML = '';

  let queue = 1;

  while(queue > 0){
    queue--;

    const prize = await animateOnce();
    log.innerHTML += `• ${prize.text}<br>`;

    if(prize.text === '再來一次'){
      queue++;
    }

    if(prize.text === '10連抽'){
      for(let i=0;i<10;i++){
        const tenPrize = await animateOnce(['再來一次','10連抽']);
        log.innerHTML += `→ ${tenPrize.text}<br>`;
        await new Promise(r=>setTimeout(r,120));
      }
    }

    await new Promise(r=>setTimeout(r,150));
  }

  btn.disabled = false;
}

btn.addEventListener('click', doDraw);
</script>

</body>
</html>
